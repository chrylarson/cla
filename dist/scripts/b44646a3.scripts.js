"use strict";angular.module("claApp",["ngCookies","ngSanitize","ngRoute","ngAnimate"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("claApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.nodes={nodes:[{name:"Front Panel Object to JSON.vi",group:2},{name:"Array to JSON Object.vi",group:2},{name:"Scale to JSON.vi",group:2},{name:"Caption to JSON.vi",group:2},{name:"Label to JSON.vi",group:2}],links:[{source:0,target:1,value:4},{source:0,target:2,value:4},{source:0,target:3,value:4},{source:0,target:4,value:4}]}}]),angular.module("claApp").directive("forceDiagram",function(){return{template:'<div id="viz"></div>',restrict:"E",scope:{nodes:"="},link:function(a){function b(a){return a.name}function c(){var a=h.selectAll(".link"),c=h.selectAll(".node"),i=d3.layout.force().charge(-2e3).friction(.3).linkDistance(50).size([f,g]);i.on("tick",function(){c.attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).attr("clip-path",function(a){return"url(#clip-"+a.index+")"}),a.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y});var b=h.selectAll(".clip").data(d(c.data()),function(a){return a.point.index});b.enter().append("clipPath").attr("id",function(a){return"clip-"+a.point.index}).attr("class","clip"),b.exit().remove(),b.selectAll("path").remove(),b.append("path").attr("d",function(a){return"M"+a.join(",")+"Z"})}),e.nodes.forEach(function(a,b){a.id=b}),a=h.selectAll(".link").data(e.links).enter().append("line").attr("class","link").style("stroke-width",function(a){return Math.sqrt(a.value)}),c=h.selectAll(".node").data(e.nodes).enter().append("g").attr("title",b).attr("class","node").call(i.drag),c.append("image").attr("xlink:href","http://forums.ni.com/ni/attachments/ni/170/527271/1/LV2010.ico").attr("x",-8).attr("y",-8).attr("width",16).attr("height",16),i.nodes(e.nodes).links(e.links).start()}function d(a){var b=[];return i(a).forEach(function(a){if(a.length){var c=[];a.forEach(function(b){c.push([b[0]-a.point.x,b[1]-a.point.y])}),c.point=a.point,b.push(c)}}),b}var e=a.nodes,f=(d3.scale.category10(),960),g=500,h=d3.select("#viz").append("svg").attr("width",f).attr("height",g),i=d3.geom.voronoi().x(function(a){return a.x}).y(function(a){return a.y}).clipExtent([[-10,-10],[f+10,g+10]]);c()}}}),angular.module("claApp").directive("forceDiagramLegend",function(){return{template:'<div id="viz1"></div>',restrict:"E",scope:{nodes:"="},link:function(a){function b(){var a=f(g),b=d3.layout.tree().links(a);console.log("force diagram legend"),j.nodes(a).links(b).start(),l=l.data(b,function(a){return a.target.id}),l.exit().remove(),l.enter().insert("line",".node").attr("class","link").attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),m=m.data(a,function(a){return a.id}).style("fill",d),m.exit().remove(),m.enter().append("circle").attr("class","node").attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).attr("r",function(a){return Math.sqrt(a.size)/10||4.5}).style("fill",d).on("click",e).call(j.drag)}function c(){l.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),m.attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y})}function d(a){return a._children?"#3182bd":a.children?"#c6dbef":"#fd8d3c"}function e(a){d3.event.defaultPrevented||(a.children?(a._children=a.children,a.children=null):(a.children=a._children,a._children=null),b())}function f(a){function b(a){a.children&&a.children.forEach(b),a.id||(a.id=++d),c.push(a)}var c=[],d=0;return b(a),c}var g=a.nodes,d=d3.scale.category10(),h=960,i=500,j=d3.layout.force().size([h,i]).on("tick",c),k=d3.select("#viz1").append("svg").attr("width",h).attr("height",i),l=k.selectAll(".link"),m=k.selectAll(".node");b()}}});