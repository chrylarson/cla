"use strict";angular.module("claApp",["ngCookies","ngSanitize","ngRoute","ngAnimate"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("claApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.data={nodes:{nodes:[{name:"Front Panel Object to JSON.vi",group:2},{name:"Array to JSON Object.vi",group:2},{name:"Scale to JSON.vi",group:2},{name:"Caption to JSON.vi",group:2},{name:"Label to JSON.vi",group:2}],links:[{source:0,target:1,value:4},{source:0,target:2,value:4},{source:0,target:3,value:4},{source:0,target:4,value:4}]}},a.$watch("data.nodes",function(a,b){console.log("What"),a!==b&&console.log("This is coming from the controller to the directive now = ",a)},!0)}]),angular.module("claApp").directive("forceDiagram",function(){return{template:'<div id="viz"></div>',restrict:"E",scope:{nodes:"="},link:function(a){function b(a){return a.name}function c(){h.nodes(a.nodes.nodes).links(a.nodes.links).start(),a.nodes.nodes.forEach(function(a,b){a.id=b}),j=j.data(a.nodes.links),j.exit().remove(),j.enter().append("line").attr("class","link").style("stroke-width",function(a){return Math.sqrt(a.value)}),k=k.data(a.nodes.nodes),k.exit().remove(),k.enter().append("g").attr("title",b).attr("class","node").call(h.drag),k.append("image").attr("xlink:href","http://forums.ni.com/ni/attachments/ni/170/527271/1/LV2010.ico").attr("x",-8).attr("y",-8).attr("width",16).attr("height",16).on("click",e)}function d(a){var b=[];return l(a).forEach(function(a){if(a.length){var c=[];a.forEach(function(b){c.push([b[0]-a.point.x,b[1]-a.point.y])}),c.point=a.point,b.push(c)}}),b}function e(b){console.log("clicked"),d3.event.defaultPrevented||(a.nodes.links.forEach(function(c,d){console.log(c.source.id+" : "+c.target.id+" : "+b.id),(c.source.id===b.id||c.target.id===b.id)&&(console.log("true"),a.nodes.links.splice(d,1))}),a.nodes.nodes.splice(b.index,1),c())}var f=(d3.scale.category10(),500),g=500,h=d3.layout.force().charge(-2e3).friction(.3).linkDistance(50).size([f,g]).on("tick",function(){k.attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).attr("clip-path",function(a){return"url(#clip-"+a.index+")"}),j.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y});var a=i.selectAll(".clip").data(d(k.data()),function(a){return a.point.index});a.enter().append("clipPath").attr("id",function(a){return"clip-"+a.point.index}).attr("class","clip"),a.exit().remove(),a.selectAll("path").remove(),a.append("path").attr("d",function(a){return"M"+a.join(",")+"Z"})}),i=d3.select("#viz").append("svg").attr("width",f).attr("height",g),j=i.selectAll(".link"),k=i.selectAll(".node"),l=d3.geom.voronoi().x(function(a){return a.x}).y(function(a){return a.y}).clipExtent([[-10,-10],[f+10,g+10]]);c(),a.$watch("nodes",function(a,b){a!==b&&(console.log("Diagram Update"),c())},!0)}}}),angular.module("claApp").directive("forceDiagramLegend",function(){return{templateUrl:"views/templates/forceDiagramLegend.html",restrict:"E",scope:{nodes:"="},link:function(a){a.toggle=function(b){a.nodes.links.forEach(function(c,d){console.log(c.source.id+" : "+c.target.id+" : "+b.id),(c.source.id===b.id||c.target.id===b.id)&&(console.log("true"),a.nodes.links.splice(d,1))}),a.nodes.nodes.splice(b.index,1)},a.$watch("nodes",function(a,b){a!==b&&console.log("Legend Update")},!0)}}});